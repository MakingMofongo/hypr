# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

This is a Hyprland window manager configuration based on JaKooLit's Hyprland-Dots (https://github.com/JaKooLit). The configuration is modular, separating default configs from user customizations to enable safe updates via `upgrade.sh`.

## Configuration Architecture

### Directory Structure

```
~/.config/hypr/
├── hyprland.conf              # Main entry point - sources all configs
├── configs/                   # Default configs (overwritten by upgrade.sh)
│   └── Keybinds.conf         # Pre-configured keybindings
├── UserConfigs/              # User configs (persist through upgrades)
│   ├── 01-UserDefaults.conf  # Default apps/editor definitions
│   ├── UserKeybinds.conf     # Custom keybindings
│   ├── UserSettings.conf     # Hyprland settings (input, gestures, etc.)
│   ├── UserDecorations.conf  # Window decorations
│   ├── UserAnimations.conf   # Animation configurations
│   ├── WindowRules.conf      # Window and layer rules
│   ├── ENVariables.conf      # Environment variables
│   ├── Laptops.conf          # Laptop-specific hardware bindings
│   ├── LaptopDisplay.conf    # Laptop display settings
│   └── Startup_Apps.conf     # Startup applications
├── scripts/                   # System scripts (overwritten by upgrade.sh)
├── UserScripts/              # User scripts (persist through upgrades)
├── animations/               # Animation presets
├── Monitor_Profiles/         # Monitor profiles (nwg-displays)
├── monitors.conf             # Current monitor configuration
├── workspaces.conf           # Current workspace configuration
├── wallpaper_effects/        # Wallpaper storage for effects
├── wallust/                  # Wallust color scheme integration
└── initial-boot.sh           # One-time initialization script
```

### Configuration Loading Order

The main `hyprland.conf` sources configs in this order:

1. **initial-boot.sh** - Runs once on first boot (marker: `.initial_startup_done`)
2. **configs/Keybinds.conf** - Default keybindings
3. **UserConfigs/** in sequence:
   - Startup_Apps.conf
   - ENVariables.conf
   - Laptops.conf
   - LaptopDisplay.conf
   - WindowRules.conf
   - UserDecorations.conf
   - UserAnimations.conf
   - UserKeybinds.conf (sources 01-UserDefaults.conf first)
   - UserSettings.conf
   - 01-UserDefaults.conf
4. **monitors.conf** and **workspaces.conf** (generated by nwg-displays)

### Key Variables

All scripts use these standard variables:

```conf
$mainMod = SUPER
$scriptsDir = $HOME/.config/hypr/scripts
$UserScripts = $HOME/.config/hypr/UserScripts
$UserConfigs = $HOME/.config/hypr/UserConfigs

# From 01-UserDefaults.conf:
$term = foot              # Default terminal
$files = thunar           # Default file manager
$edit = kate              # Default editor
$Search_Engine = "..."    # Search URL with {} placeholder
```

## Key Systems

### Variable Sourcing Pattern

`UserKeybinds.conf` sources `01-UserDefaults.conf` first to access `$term`, `$files`, and `$edit` variables. Always check this dependency when modifying keybinds.

### Wallpaper and Theming System

The configuration uses **swww** (wayland wallpaper daemon) and **wallust** (pywal alternative) for dynamic theming:

1. **swww** displays wallpapers with transitions
2. **WallustSwww.sh** detects current wallpaper from swww cache
3. **wallust** generates color schemes from the wallpaper
4. Generated colors are applied to:
   - Waybar (CSS)
   - Rofi (rasi)
   - Hyprland (border colors via wallust-hyprland.conf)
   - swaync (notification daemon CSS)

Current wallpaper is symlinked/copied to:
- `~/.config/rofi/.current_wallpaper` (symlink)
- `~/.config/hypr/wallpaper_effects/.wallpaper_current` (copy)

### Refresh System

`scripts/Refresh.sh` updates UI components after wallpaper/theme changes:
- Waybar: Auto-reloads via `reload_style_on_change` config option
- swaync: Reloads CSS via `swaync-client --reload-css`
- ags: Restarts if running
- RainbowBorders: Relaunches if enabled

**Keybind**: `SUPER + ALT + R`

### Window Rules (Tag-Based System)

`UserConfigs/WindowRules.conf` uses tags for organized rule management:

1. **Define tags** first: `windowrulev2 = tag +<name>, class:pattern`
2. **Apply rules to tags**: Use `tag:name*` with wildcards

Tag categories: `browser`, `terminal`, `email`, `projects`, `im`, `games`, `gamestore`, `file-manager`, `settings`, `viewer`, `multimedia`

When adding rules for new apps, assign them to an existing tag or create a new category.

### Monitor and Workspace Management

- **monitors.conf** and **workspaces.conf** are managed by `nwg-displays`
- Manual workspace assignments in `hyprland.conf` (lines 45-56)
- Monitor profiles stored in `Monitor_Profiles/`

Current setup assigns workspaces 1-5 to eDP-1 (laptop) and 6-10 to DP-2 (external).

## Common Tasks

### Reload Configuration

```bash
# Reload Hyprland config
hyprctl reload

# Full UI refresh (wallpaper, waybar, swaync, ags)
~/.config/hypr/scripts/Refresh.sh

# Keybind: SUPER + ALT + R
```

### Change Default Applications

Edit `UserConfigs/01-UserDefaults.conf`:

```conf
env = EDITOR,<your-editor>
$term = <terminal>
$files = <file-manager>
$edit = <editor-for-settings-menu>
$Search_Engine = "<url-with-{}>"
```

### Add Custom Keybinds

Add to `UserConfigs/UserKeybinds.conf` (after line 15, which sources 01-UserDefaults.conf):

```conf
bind = $mainMod SHIFT, <KEY>, exec, <command>
```

Check `configs/Keybinds.conf` to avoid conflicts.

### Laptop Hardware Configuration

Edit `UserConfigs/Laptops.conf`:
- Set `$Touchpad_Device` (get device name via `hyprctl devices`)
- Customize Fn key bindings (brightness, touchpad toggle, keyboard backlight)
- Enable lid switch handling if needed

### Add Window Rules

In `UserConfigs/WindowRules.conf`:

1. Identify window class: `hyprctl activewindow`
2. Add to existing tag or create new tag
3. Example:
```conf
windowrulev2 = tag +browser, class:^(firefox)$
windowrulev2 = opacity 0.95, tag:browser*
```

### Manage Startup Applications

Edit `UserConfigs/Startup_Apps.conf`:

```conf
exec-once = <command>  # Runs once at startup
```

Key daemons: `swww-daemon`, `waybar`, `swaync`, `hypridle`, `ags` (optional)

## Debugging

```bash
# List all keybinds
hyprctl binds

# Get device names (for Laptops.conf touchpad config)
hyprctl devices

# Get active window details (class, title, etc.)
hyprctl activewindow

# Get option value
hyprctl getoption <option-name>

# Test option temporarily (doesn't persist)
hyprctl keyword <section:option> <value>

# View Hyprland logs
journalctl -xe -u hyprland
```

## Version Dependencies

- Target Hyprland version: **v0.41.2+** (Debian/Ubuntu packages)
- Some configs have version-specific comments (e.g., UserKeybinds.conf lines 52-54 for v0.39)
- Cursor options changed between v0.39 and v0.41+ (`misc:cursor_zoom_factor` → `cursor:zoom_factor`)
- Check comments for deprecated syntax when upgrading Hyprland

## Important Files Not to Modify

- **configs/Keybinds.conf** - Overwritten by upgrade.sh
- **scripts/** - Overwritten by upgrade.sh (use UserScripts/ instead)
- **.initial_startup_done** - Marker file preventing initial-boot.sh from re-running
- **monitors.conf / workspaces.conf** - Managed by nwg-displays

## Safe Modification Areas

Files that persist through `upgrade.sh`:
- **UserConfigs/** (all files)
- **UserScripts/** (all files)
- **wallpaper_effects/**
- **Monitor_Profiles/**

## Related Documentation

- Hyprland Wiki: https://wiki.hyprland.org/
- Window Rules: https://wiki.hyprland.org/Configuring/Window-Rules/
- Variables: https://wiki.hyprland.org/Configuring/Variables/
- Binds: https://wiki.hyprland.org/Configuring/Binds/
- JaKooLit's GitHub: https://github.com/JaKooLit
